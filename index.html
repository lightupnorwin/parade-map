<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Light Up Norwin Parade Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; width: 100%; }

    /* Filter bar */
    .filter-bar {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      padding: 6px 10px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.25);
      z-index: 1000;
      flex-wrap: wrap;
      justify-content: center;
    }
    .filter-btn {
      border-radius: 999px;
      padding: 6px 12px;
      font-weight: 700;
      cursor: pointer;
      transition: .2s ease;
      user-select: none;
      border: 2px solid transparent;
      color: #fff;
    }
    .filter-btn.Restrooms { background: #007aff; border-color: #007aff; }
    .filter-btn.Events    { background: #ff3b30; border-color: #ff3b30; }
    .filter-btn.Food      { background: #34c759; border-color: #34c759; }
    .filter-btn.Shopping  { background: #af52de; border-color: #af52de; }
    .filter-btn.inactive  { background: #fff !important; color: #333 !important; }

    /* Popup styling */
    .leaflet-popup-content-wrapper {
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    .popup h3 {
      margin: 0 0 4px;
      font-size: 16px;
      color: #222;
    }
    .popup p {
      margin: 0;
      font-size: 14px;
      line-height: 1.4;
    }

    /* Route line glow */
    @keyframes dash {
      to { stroke-dashoffset: -1000; }
    }
    .glow-line {
      stroke-dasharray: 10 6;
      stroke-linecap: round;
      animation: dash 20s linear infinite;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="filter-bar">
    <button class="filter-btn Restrooms" data-category="Restrooms">Restrooms</button>
    <button class="filter-btn Events" data-category="Events">Events</button>
    <button class="filter-btn Food" data-category="Food">Food &amp; Beverage</button>
    <button class="filter-btn Shopping" data-category="Shopping">Shopping</button>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map', { zoomControl: true }).setView([40.332, -79.7105], 18);

    // --- Base tiles ---
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 20,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const colors = {
      Restrooms: "#007aff",
      Events:    "#ff3b30",
      Food:      "#34c759",
      Shopping:  "#af52de"
    };

    // --- Icon builder (emoji SVGs) ---
    function makeIcon(emoji, color) {
      const svg = encodeURIComponent(`
        <svg xmlns='http://www.w3.org/2000/svg' width='40' height='40'>
          <circle cx='20' cy='20' r='18' fill='${color}' />
          <text x='50%' y='55%' font-size='18' text-anchor='middle' fill='white'>${emoji}</text>
        </svg>
      `);
      return L.icon({
        iconUrl: "data:image/svg+xml," + svg,
        iconSize: [30, 30],
        iconAnchor: [15, 30],
        popupAnchor: [0, -28]
      });
    }

    const icons = {
      Restrooms: makeIcon("üöª", colors.Restrooms),
      Events:    makeIcon("üéÑ", colors.Events),
      Food:      makeIcon("üçî", colors.Food),
      Shopping:  makeIcon("üõçÔ∏è", colors.Shopping)
    };

    // --- Locations ---
    const locations = [
      { position: [40.3314911, -79.710878], name: "Restrooms", description: "Public restrooms at 415 Main St.", category: "Restrooms" },
      { position: [40.332795, -79.710338], name: "Tree Lighting", description: "At S&T Bank. Ceremony starts at 6 PM.", category: "Events" },
      { position: [40.332008, -79.711068], name: "Main Street Stage", description: "<strong>Schedule</strong><br>4:00 PM ‚Äì Band<br>6:00 PM ‚Äì Band", category: "Events" },
      { position: [40.331993, -79.710851], name: "Pretend Food Vendor", description: "Serving warm treats all evening.", category: "Food" },
      { position: [40.332086, -79.710864], name: "Pretend Craft Vendor", description: "Handmade gifts and holiday crafts.", category: "Shopping" }
    ];

    const markers = [];
    function addMarker(loc) {
      const marker = L.marker(loc.position, { icon: icons[loc.category] })
        .bindPopup(`<div class="popup"><h3>${loc.name}</h3><p>${loc.description}</p></div>`);
      marker.category = loc.category;
      marker.addTo(map);
      markers.push(marker);
    }
    locations.forEach(addMarker);

    // --- Auto fit to all markers ---
    const group = L.featureGroup(markers);
    map.fitBounds(group.getBounds(), { padding: [40, 40] });

    // --- Parade route (accurate path: 3rd ‚Üí Main ‚Üí Pennsylvania) ---
    const routeCoords = [
      [40.33272, -79.71247],  // 3rd St & Main
      [40.33235, -79.71137],  // midway down Main
      [40.33189, -79.71037],  // 2nd St area
      [40.33142, -79.70963]   // Pennsylvania Ave & Main
    ];
    L.polyline(routeCoords, {
      color: "#FFD700",
      weight: 6,
      opacity: 0.9,
      className: "glow-line"
    }).addTo(map);

    // --- Filter functionality ---
    const buttons = document.querySelectorAll('.filter-btn');
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        btn.classList.toggle('inactive');
        updateMarkers();
      });
    });

    function updateMarkers() {
      const active = new Set(
        Array.from(buttons)
          .filter(b => !b.classList.contains('inactive'))
          .map(b => b.dataset.category)
      );
      markers.forEach(m => {
        if (active.has(m.category)) {
          m.addTo(map);
        } else {
          map.removeLayer(m);
        }
      });
    }
  </script>
</body>
</html>
