<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Light Up Norwin Parade Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<style>
  html, body { height:100%; margin:0; overflow:hidden; }
  #map { height:100%; width:100%; position:absolute; top:0; left:0; z-index:1; }

  :root {
    --brand:#1756ff;
    --bg:#fff;
    --ink:#111;
    --muted:#666;
    --panel-bg:linear-gradient(180deg,#fff 0%,#f8f9fb 100%);
    --nav-bg:#fff;
  }

  body {
    background:var(--bg);
    color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    transition:background .3s,color .3s;
  }

  /* Overlay panels */
  .view {
    position:absolute; left:0; bottom:0; width:100%;
    background:var(--panel-bg);
    border-top-left-radius:16px; border-top-right-radius:16px;
    box-shadow:0 -3px 15px rgba(0,0,0,0.2);
    padding:56px 18px calc(80px + env(safe-area-inset-bottom));
    max-height:70vh;
    overflow-y:auto; -webkit-overflow-scrolling:touch;
    transform:translateY(110%);
    transition:transform .4s ease;
    z-index:10; backdrop-filter:blur(8px);
  }
  .view.active { transform:translateY(0); }

  /* Close button (fixed & safe-area aware) */
  .close-btn {
    position: fixed;
    top: calc(env(safe-area-inset-top, 0px) + 12px);
    right: calc(env(safe-area-inset-right, 0px) + 16px);
    border: none;
    background: rgba(255,255,255,0.95);
    color: #000;
    font-size: 22px;
    border-radius: 50%;
    width: 44px;
    height: 44px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor: pointer;
    box-shadow: 0 3px 10px rgba(0,0,0,0.25);
    transition: background .3s, transform .1s;
    z-index: 50;
    backdrop-filter: blur(8px);
  }
  .close-btn:active { transform: scale(0.95); }

  /* Floating location button */
  .map-actions {
    position:absolute; bottom:90px; right:20px;
    display:flex; flex-direction:column; gap:8px; z-index:9;
  }
  .map-actions button {
    background:#fff; border:none; border-radius:50%;
    width:46px; height:46px; font-size:22px; cursor:pointer;
    box-shadow:0 2px 8px rgba(0,0,0,0.3);
    transition:transform .15s ease, background .3s, color .3s;
  }
  .map-actions button:active { transform:scale(0.95); }
  @keyframes pulse {
    0%{box-shadow:0 0 0 0 rgba(23,86,255,0.6);}
    70%{box-shadow:0 0 0 10px rgba(23,86,255,0);}
    100%{box-shadow:0 0 0 0 rgba(23,86,255,0);}
  }
  .pulse { animation:pulse 1.5s infinite; }

  /* Nav bar */
  .nav-bar {
    position:fixed; bottom:0; left:0; width:100%; height:60px;
    background:var(--nav-bg); border-top:1px solid #ddd;
    display:flex; justify-content:space-around; align-items:center;
    box-shadow:0 -2px 10px rgba(0,0,0,0.15); z-index:11;
  }
  .nav-item {
    flex:1; text-align:center; color:#555; font-size:12px;
    text-decoration:none; font-weight:600; cursor:pointer;
    transition:color .3s;
  }
  .nav-item span { display:block; font-size:22px; margin-bottom:2px; }
  .nav-item.active { color:var(--brand); }

  /* Card content */
  .card { background:transparent; }
  .row { padding:8px 0; border-top:1px solid rgba(0,0,0,0.1); }
  .btn {
    background:var(--brand); color:#fff; padding:6px 10px;
    border:none; border-radius:8px; cursor:pointer; font-weight:600;
  }
  .btn:active { transform:scale(0.97); }
</style>
</head>

<body>
<div id="map"></div>

<!-- Floating location control -->
<div class="map-actions">
  <button id="locateMe" title="Use my location">üìç</button>
</div>

<!-- Panels -->
<div id="view-schedule" class="view">
  <button class="close-btn" onclick="hidePanels()">‚úï</button>
  <h1>üìÖ Schedule</h1>
  <div class="card">
    <div class="row" id="stage"><strong>4:00 PM</strong> ‚Äì Main Street Stage ‚Äî Norwin Jazz Ensemble</div>
    <div class="row" id="tree"><strong>5:45 PM</strong> ‚Äì S&T Bank Plaza ‚Äî Tree Lighting</div>
    <div class="row" id="parade"><strong>6:15 PM</strong> ‚Äì Parade Step-Off ‚Äî 3rd & Main</div>
  </div>
</div>

<div id="view-vendors" class="view">
  <button class="close-btn" onclick="hidePanels()">‚úï</button>
  <h1>üçî Food & Shopping</h1>
  <div class="card">
    <div class="row"><div>Pretend Food Vendor</div><button class="btn" onclick="focusLocation('Food Vendor')">Show on Map</button></div>
    <div class="row"><div>Pretend Craft Vendor</div><button class="btn" onclick="focusLocation('Craft Vendor')">Show on Map</button></div>
  </div>
</div>

<div id="view-restrooms" class="view">
  <button class="close-btn" onclick="hidePanels()">‚úï</button>
  <h1>üöª Restrooms</h1>
  <div class="card">
    <div class="row"><div>415 Main St (Public)</div><button class="btn" onclick="focusLocation('Restrooms')">Show on Map</button></div>
    <div class="row"><div>Portable Units ‚Äî S&T Bank Plaza</div><button class="btn" onclick="focusLocation('Tree Lighting')">Show on Map</button></div>
  </div>
</div>

<!-- Nav -->
<nav class="nav-bar">
  <div class="nav-item" data-view="schedule"><span>üìÖ</span>Schedule</div>
  <div class="nav-item" data-view="vendors"><span>üçî</span>Vendors</div>
  <div class="nav-item" data-view="restrooms"><span>üöª</span>Restrooms</div>
</nav>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
/* --- Map setup --- */
const map = L.map('map',{zoomControl:true}).setView([40.332,-79.7105],18);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
  {maxZoom:20, attribution:'&copy; OpenStreetMap'}).addTo(map);

const colors = {
  Restrooms:"#007aff", Events:"#ff3b30", Food:"#34c759", Shopping:"#af52de"
};
function makeIcon(emoji,color){
  const svg = encodeURIComponent(
    `<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40'>
      <circle cx='20' cy='20' r='18' fill='${color}'/>
      <text x='50%' y='55%' font-size='18' text-anchor='middle' fill='white'>${emoji}</text>
    </svg>`
  );
  return L.icon({iconUrl:"data:image/svg+xml,"+svg,iconSize:[30,30],iconAnchor:[15,30],popupAnchor:[0,-28]});
}
const icons = {
  Restrooms:makeIcon("üöª",colors.Restrooms),
  Events:makeIcon("üéÑ",colors.Events),
  Food:makeIcon("üçî",colors.Food),
  Shopping:makeIcon("üõçÔ∏è",colors.Shopping)
};
const locations = [
  {position:[40.3314911,-79.710878],name:"Restrooms",description:"Public restrooms at 415 Main St.",category:"Restrooms"},
  {position:[40.332795,-79.710338],name:"Tree Lighting",description:"At S&T Bank Plaza.",category:"Events"},
  {position:[40.332008,-79.711068],name:"Main Street Stage",description:"Live performances.",category:"Events"},
  {position:[40.331993,-79.710851],name:"Food Vendor",description:"Serving warm treats all evening.",category:"Food"},
  {position:[40.332086,-79.710864],name:"Craft Vendor",description:"Handmade holiday crafts.",category:"Shopping"}
];
const markers=[];
locations.forEach(loc=>{
  const m=L.marker(loc.position,{icon:icons[loc.category]})
    .bindPopup(`<div class='popup'><h3>${loc.name}</h3><p>${loc.description}</p></div>`)
    .addTo(map);
  m.name=loc.name; markers.push(m);
});
const group=L.featureGroup(markers);
map.fitBounds(group.getBounds(),{padding:[40,40]});

/* Focus marker */
function focusLocation(name){
  const target=markers.find(m=>m.name===name);
  if(target){ hidePanels(); map.setView(target.getLatLng(),19); target.openPopup(); }
}

/* Locate Me */
const locateBtn=document.getElementById("locateMe");
locateBtn.onclick=()=>{
  locateBtn.classList.add("pulse");
  navigator.geolocation?.getCurrentPosition(pos=>{
    const{latitude,longitude}=pos.coords;
    map.setView([latitude,longitude],18);
    L.circleMarker([latitude,longitude],{radius:8,color:"#1756ff",fillOpacity:0.9})
      .addTo(map).bindPopup("You are here").openPopup();
    setTimeout(()=>locateBtn.classList.remove("pulse"),2000);
  },()=>locateBtn.classList.remove("pulse"));
};

/* Panel toggling */
const navItems=document.querySelectorAll('.nav-item');
const panels=document.querySelectorAll('.view');
let current=null;
function hidePanels(){
  panels.forEach(v=>v.classList.remove('active'));
  navItems.forEach(n=>n.classList.remove('active'));
  current=null;
}
function togglePanel(view){
  if(current===view){hidePanels();return;}
  hidePanels();
  document.getElementById('view-'+view).classList.add('active');
  document.querySelector(`.nav-item[data-view="${view}"]`).classList.add('active');
  current=view;
}
navItems.forEach(i=>i.addEventListener('click',()=>togglePanel(i.dataset.view)));
</script>
</body>
</html>
