<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Light Up Norwin Parade Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css"
    />
    <style>
      body, html {
        margin: 0;
        padding: 0;
        height: 100%;
        background: #1a1a1a;
        color: #fff;
        font-family: Arial, sans-serif;
      }
      #map {
        width: 100%;
        height: 100%;
      }
      .leaflet-popup-content-wrapper {
        background: #2c2c2c;
        color: #fff;
        border-radius: 8px;
      }
      .leaflet-popup-tip {
        background: #2c2c2c;
      }
      .leaflet-routing-container {
        background: rgba(40,40,40,0.9);
        color: #fff;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
    <script>
      const map = L.map("map").setView([40.3322, -79.7109], 18);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "&copy; OpenStreetMap contributors",
      }).addTo(map);

      // Marker categories
      const groups = {
        Restrooms: L.layerGroup(),
        Events: L.layerGroup(),
        "Food & Beverage": L.layerGroup(),
        Shopping: L.layerGroup(),
      };

      const locations = [
        {
          position: [40.332008, -79.711068],
          name: "Main Street Stage",
          description: "Live entertainment at the arch on Main St.",
          category: "Events",
        },
        {
          position: [40.332795, -79.710338],
          name: "Tree Lighting",
          description: "At S&T Bank, begins at 6 PM.",
          category: "Events",
        },
        {
          position: [40.3326, -79.7097],
          name: "Restrooms",
          description: "Public restrooms at 415 Main St.",
          category: "Restrooms",
        },
        {
          position: [40.331993, -79.710851],
          name: "Food Vendor",
          description: "Pretend food vendor serving snacks.",
          category: "Food & Beverage",
        },
        {
          position: [40.332086, -79.710864],
          name: "Craft Vendor",
          description: "Pretend craft vendor with handmade goods.",
          category: "Shopping",
        },
      ];

      // Add markers
      locations.forEach(loc => {
        const marker = L.marker(loc.position).bindPopup(
          "<b>" + loc.name + "</b><br>" + loc.description + 
          "<br><button onclick='startRoute(["+loc.position+"])'>Get Walking Directions</button>"
        );
        groups[loc.category].addLayer(marker);
      });

      Object.values(groups).forEach(group => group.addTo(map));
      L.control.layers(null, groups, { collapsed: false }).addTo(map);

      // Routing control (hidden until needed)
      let routingControl;

      function startRoute(dest) {
        if (routingControl) {
          map.removeControl(routingControl);
        }
        // Demo "start" is fixed at map center; could be user location later
        const start = [40.3322, -79.7109];
        routingControl = L.Routing.control({
          waypoints: [
            L.latLng(start[0], start[1]),
            L.latLng(dest[0], dest[1])
          ],
          lineOptions: {
            styles: [{ color: "#ff3333", dashArray: "5, 10", weight: 4 }]
          },
          routeWhileDragging: false,
          show: true,
          addWaypoints: false
        }).addTo(map);
      }
    </script>
  </body>
</html>
