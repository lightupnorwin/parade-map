<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Light Up Norwin Parade Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  html,body{height:100%;margin:0;}
  #map{height:100%;width:100%;}
  :root{--brand:#1756ff;--ink:#111;--muted:#666;--bg:#fff;--card:#f7f7fb;}
  body{background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;}

  /* Panels */
  .view{display:none;padding:16px 14px 80px;max-width:780px;margin:0 auto;}
  .view.active{display:block;animation:fadeIn .3s;}
  @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}

  h1{font-size:20px;margin:0 0 10px;}
  .card{background:linear-gradient(180deg,#fff 0%,#f8f9fb 100%);
        border-radius:16px;padding:12px 14px;margin-top:12px;
        box-shadow:0 3px 8px rgba(0,0,0,0.05);}
  .row{display:flex;justify-content:space-between;align-items:center;
       padding:8px 0;border-top:1px solid #e8e8ef;}
  .row:first-child{border-top:0;}
  .btn{background:var(--brand);color:#fff;padding:8px 12px;border:none;
       border-radius:8px;cursor:pointer;font-weight:600;}
  .btn:active{transform:scale(0.97);}
  .muted{color:var(--muted);}
  .active-now{box-shadow:0 0 10px 2px var(--brand);border-radius:12px;}

  /* Floating map actions */
  .map-actions{position:absolute;bottom:90px;right:20px;
    display:flex;flex-direction:column;gap:10px;z-index:1000;}
  .map-actions button{
    background:#fff;border:none;border-radius:50%;width:46px;height:46px;
    font-size:22px;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.3);}
  .map-actions button:active{transform:scale(0.95);}

  /* Bottom nav */
  .nav-bar{position:fixed;bottom:0;left:0;width:100%;height:60px;
    background:#fff;border-top:1px solid #ddd;
    display:flex;justify-content:space-around;align-items:center;
    box-shadow:0 -2px 10px rgba(0,0,0,0.15);z-index:2000;}
  .nav-item{flex:1;text-align:center;color:#555;font-size:12px;
    text-decoration:none;font-weight:600;cursor:pointer;}
  .nav-item span{display:block;font-size:22px;margin-bottom:2px;}
  .nav-item.active{color:var(--brand);}
</style>
</head>

<body>
<div id="map"></div>
<div class="map-actions">
  <button id="locateMe">üìç</button>
  <button id="resetView">üîÑ</button>
</div>

<!-- Schedule -->
<div id="view-schedule" class="view">
  <h1>üìÖ Schedule</h1>
  <div class="card">
    <div class="row" id="stage"><strong>4:00 PM</strong> ‚Äì Main Street Stage ‚Äî Norwin Jazz Ensemble</div>
    <div class="row" id="tree"><strong>5:45 PM</strong> ‚Äì S&T Bank Plaza ‚Äî Tree Lighting</div>
    <div class="row" id="parade"><strong>6:15 PM</strong> ‚Äì Parade Step-Off ‚Äî 3rd & Main</div>
  </div>
</div>

<!-- Vendors -->
<div id="view-vendors" class="view">
  <h1>üçî Food & Shopping</h1>
  <div class="card">
    <div class="row"><div>Pretend Food Vendor</div><button class="btn" onclick="focusLocation('Food Vendor')">Show on Map</button></div>
    <div class="row"><div>Pretend Craft Vendor</div><button class="btn" onclick="focusLocation('Craft Vendor')">Show on Map</button></div>
  </div>
</div>

<!-- Restrooms -->
<div id="view-restrooms" class="view">
  <h1>üöª Restrooms</h1>
  <div class="card">
    <div class="row"><div>415 Main St (Public)</div><button class="btn" onclick="focusLocation('Restrooms')">Show on Map</button></div>
    <div class="row"><div>Portable Units ‚Äî S&T Bank Plaza</div><button class="btn" onclick="focusLocation('Tree Lighting')">Show on Map</button></div>
  </div>
</div>

<!-- Nav bar -->
<nav class="nav-bar">
  <div class="nav-item active" data-view="map"><span>üó∫Ô∏è</span>Map</div>
  <div class="nav-item" data-view="schedule"><span>üìÖ</span>Schedule</div>
  <div class="nav-item" data-view="vendors"><span>üçî</span>Vendors</div>
  <div class="nav-item" data-view="restrooms"><span>üöª</span>Restrooms</div>
</nav>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
/* --- Map setup --- */
const map=L.map('map',{zoomControl:true}).setView([40.332,-79.7105],18);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:20,attribution:'&copy; OpenStreetMap'}).addTo(map);

const colors={Restrooms:"#007aff",Events:"#ff3b30",Food:"#34c759",Shopping:"#af52de"};
function makeIcon(emoji,color){
  const svg=encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40'><circle cx='20' cy='20' r='18' fill='${color}'/><text x='50%' y='55%' font-size='18' text-anchor='middle' fill='white'>${emoji}</text></svg>`);
  return L.icon({iconUrl:"data:image/svg+xml,"+svg,iconSize:[30,30],iconAnchor:[15,30],popupAnchor:[0,-28]});
}
const icons={Restrooms:makeIcon("üöª",colors.Restrooms),Events:makeIcon("üéÑ",colors.Events),
             Food:makeIcon("üçî",colors.Food),Shopping:makeIcon("üõçÔ∏è",colors.Shopping)};
const locations=[
  {position:[40.3314911,-79.710878],name:"Restrooms",description:"Public restrooms at 415 Main St.",category:"Restrooms"},
  {position:[40.332795,-79.710338],name:"Tree Lighting",description:"At S&T Bank Plaza.",category:"Events"},
  {position:[40.332008,-79.711068],name:"Main Street Stage",description:"Live music performances.",category:"Events"},
  {position:[40.331993,-79.710851],name:"Food Vendor",description:"Serving warm treats all evening.",category:"Food"},
  {position:[40.332086,-79.710864],name:"Craft Vendor",description:"Handmade holiday crafts.",category:"Shopping"}
];
const markers=[];
locations.forEach(loc=>{
  const m=L.marker(loc.position,{icon:icons[loc.category]})
    .bindPopup(`<div class="popup"><h3>${loc.name}</h3><p>${loc.description}</p></div>`).addTo(map);
  m.name=loc.name;markers.push(m);
});
const group=L.featureGroup(markers);map.fitBounds(group.getBounds(),{padding:[40,40]});

/* Focus a specific marker */
function focusLocation(name){
  const target=markers.find(m=>m.name===name);
  if(target){
    showView('map');
    map.setView(target.getLatLng(),19);
    target.openPopup();
  }
}

/* Locate / reset */
document.getElementById("locateMe").onclick=()=>{
  navigator.geolocation?.getCurrentPosition(pos=>{
    const{latitude,longitude}=pos.coords;
    map.setView([latitude,longitude],18);
    L.circleMarker([latitude,longitude],{radius:8,color:"#1756ff",fillOpacity:0.9})
      .addTo(map).bindPopup("You are here").openPopup();
  });
};
document.getElementById("resetView").onclick=()=>map.fitBounds(group.getBounds(),{padding:[40,40]});

/* ‚ÄúNow Happening‚Äù highlight */
const scheduleTimes=[{time:"16:00",id:"stage"},{time:"17:45",id:"tree"},{time:"18:15",id:"parade"}];
function highlightNow(){
  const now=new Date();const mins=now.getHours()*60+now.getMinutes();
  scheduleTimes.forEach(s=>{
    const[h,m]=s.time.split(":").map(Number);const t=h*60+m;
    const el=document.getElementById(s.id);
    if(!el)return;
    if(Math.abs(mins-t)<30)el.classList.add("active-now");
    else el.classList.remove("active-now");
  });
}
highlightNow();setInterval(highlightNow,60000);

/* --- Nav behaviour (toggle back to map) --- */
const navItems=document.querySelectorAll('.nav-item');
function showView(view){
  // Toggle: if same tab clicked, go back to map
  const current=document.querySelector('.view.active');
  const isSame=current && current.id==='view-'+view;
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  navItems.forEach(n=>n.classList.remove('active'));
  if(isSame || view==='map'){ // return to map
    document.getElementById('map').style.display='block';
    document.querySelector('.nav-item[data-view="map"]').classList.add('active');
    return;
  }
  document.getElementById('map').style.display='none';
  document.getElementById('view-'+view).classList.add('active');
  document.querySelector(`.nav-item[data-view="${view}"]`).classList.add('active');
}
navItems.forEach(i=>i.addEventListener('click',()=>showView(i.dataset.view)));
</script>
</body>
</html>
