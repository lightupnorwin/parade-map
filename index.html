<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Light Up Norwin Parade Map</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css">
<style>
html,body{height:100%;margin:0;overflow:hidden;}
#map{height:100%;width:100%;position:absolute;top:0;left:0;z-index:1;}
:root{
  --brand:#1756ff;
  --bg:#fff;
  --ink:#111;
  --muted:#555;
  --panel-bg:linear-gradient(180deg,#fff 0%,#f8f9fb 100%);
}
body{
  background:var(--bg);
  color:var(--ink);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
  font-size:17px; line-height:1.5;
}

/* --- Top Nav --- */
.top-nav{
  position:fixed;top:0;left:0;width:100%;height:72px;
  background:var(--panel-bg);
  display:flex;justify-content:space-around;align-items:center;
  box-shadow:0 2px 8px rgba(0,0,0,0.15);
  border-bottom:1px solid #ddd;z-index:15;
}
.nav-item{
  flex:1;text-align:center;cursor:pointer;
  font-weight:600;color:#333;font-size:16px;min-height:44px;
}
.nav-item span{display:block;font-size:26px;margin-bottom:2px;}
.nav-item.active{color:var(--brand);text-shadow:0 0 6px rgba(23,86,255,0.35);}

/* --- Panels --- */
.view{
  position:fixed;left:50%;bottom:0;transform:translate(-50%,100%);
  width:92%;max-width:640px;background:var(--panel-bg);
  border-top-left-radius:16px;border-top-right-radius:16px;
  box-shadow:0 -3px 15px rgba(0,0,0,0.25);
  display:flex;flex-direction:column;max-height:70vh;
  overflow:hidden;transition:transform 0.35s cubic-bezier(.25,.8,.25,1);
  z-index:10;backdrop-filter:blur(8px);
  pointer-events:none;visibility:hidden;
}
.view.active{
  transform:translate(-50%,0);
  pointer-events:auto;visibility:visible;z-index:20;
}
.view-header{
  position:sticky;top:0;background:var(--panel-bg);
  display:flex;align-items:center;justify-content:space-between;
  padding:18px 22px 12px;border-bottom:1px solid rgba(0,0,0,0.1);
}
.view-header h1{
  margin:0;font-size:22px;font-weight:700;
}
.close-btn{
  border:none;background:#fff;color:#000;font-size:22px;
  font-weight:bold;border-radius:50%;
  width:40px;height:40px;cursor:pointer;
  box-shadow:0 2px 8px rgba(0,0,0,0.3);
}
.scroll-inner{flex:1;overflow-y:auto;padding:14px 22px 100px;}
.row{padding:14px 0;border-top:1px solid rgba(0,0,0,0.1);}
.row:first-child{border-top:none;}
.btn{
  background:var(--brand);color:#fff;
  padding:10px 14px;border:none;border-radius:10px;
  cursor:pointer;font-weight:600;font-size:16px;min-height:44px;
}
.btn.secondary{background:#e9ecf7;color:#122;}
.btn:hover{opacity:.9;}
.btn-row{display:flex;flex-wrap:wrap;gap:10px;justify-content:flex-end;margin-top:8px;}
.badge{
  display:inline-block;background:#eef3ff;color:#245;
  font-weight:700;border-radius:999px;
  padding:3px 9px;margin-left:6px;font-size:13px;
}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.25);opacity:0;visibility:hidden;
  transition:opacity .25s;z-index:5;}
.overlay.active{opacity:1;visibility:visible;}
.search-tray{position:fixed;top:72px;left:0;width:100%;background:#fff;
  border-bottom:1px solid #ddd;z-index:14;transform:translateY(-110%);
  transition:transform .25s ease;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
.search-tray.active{transform:translateY(0);}
.search-inner{padding:12px 14px 16px;}
.search-bar{display:flex;gap:10px;}
.search-input{flex:1;border:1px solid #ddd;border-radius:12px;
  padding:12px 14px;font-size:17px;outline:none;}
.search-results{max-height:50vh;overflow:auto;margin-top:10px;}
.result{padding:12px;border-top:1px solid #eee;}
.result-title{font-weight:700;font-size:17px;}
.result-meta{color:#666;font-size:15px;margin:3px 0 6px;}
.leaflet-marker-icon{filter:drop-shadow(0 2px 4px rgba(0,0,0,0.25));}
.leaflet-routing-container{display:none;}
</style>
</head>

<body>
<div id="map"></div>
<div class="overlay" id="overlay"></div>

<!-- Restrooms Panel -->
<div id="view-restrooms" class="view">
  <div class="view-header">
    <h1>ðŸš» Restrooms</h1>
    <button class="close-btn" onclick="hidePanels()">âœ•</button>
  </div>
  <div class="scroll-inner" id="restroomList"></div>
</div>

<!-- Top Nav -->
<nav class="top-nav">
  <div class="nav-item" data-view="restrooms"><span>ðŸš»</span>Restrooms</div>
  <div class="nav-item" data-view="search"><span>ðŸ”Ž</span>Search</div>
</nav>

<!-- Search tray -->
<div class="search-tray" id="searchTray">
  <div class="search-inner">
    <div class="search-bar">
      <input id="searchInput" class="search-input" type="text" placeholder="Search restrooms, vendors, eventsâ€¦" autofocus>
      <button id="searchClear" class="btn secondary" type="button">Clear</button>
    </div>
    <div id="searchResults" class="search-results"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
<script>
const map = L.map('map',{zoomControl:true}).setView([40.3318,-79.7106],18);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:20}).addTo(map);

const colors={Restrooms:"#007aff"};
function makeIcon(e,c){
  const s=encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40'><circle cx='20' cy='20' r='18' fill='${c}'/><text x='50%' y='55%' font-size='18' text-anchor='middle' fill='white'>${e}</text></svg>`);
  return L.icon({iconUrl:"data:image/svg+xml,"+s,iconSize:[30,30],iconAnchor:[15,30],popupAnchor:[0,-28]});
}
const icons={Restrooms:makeIcon("ðŸš»",colors.Restrooms)};

// === Pins ===
const restrooms = [
  {position:[40.330953,-79.710651], name:"Restrooms â€“ Shidle Lodge", description:"Indoor restrooms inside Shidle Lodge at 415 Main St.", category:"Restrooms"},
  {position:[40.3311033,-79.7107160], name:"Portable Restroom â€“ 5th St Lot", description:"Portable restroom units located in the 5th Street Lot.", category:"Restrooms"},
  {position:[40.3326348,-79.7100816], name:"Portable Restroom â€“ 3rd St Lot", description:"Portable restroom units located in the 3rd Street Lot.", category:"Restrooms"}
];

const markers=[];
restrooms.forEach(l=>{
  const popup = `<b>${l.name}</b><br>${l.description}<br>
    <div class='btn-row'>
      <button class='btn' onclick=\"focusLocation('${l.name}')\">Show on Map</button>
      <button class='btn secondary' onclick=\"routeToByName('${l.name}')\">Get Directions</button>
    </div>`;
  const m=L.marker(l.position,{icon:icons[l.category]}).bindPopup(popup).addTo(map);
  m.name=l.name;m.category=l.category;m._desc=l.description;markers.push(m);
});
map.fitBounds(L.featureGroup(markers).getBounds(),{padding:[40,40]});

// === Restroom list panel ===
function buildRestroomList(){
  const l=document.getElementById('restroomList');
  const mk=v=>`<div class='row'><div>${v.name}<span class='badge'>${v.category}</span><br><small>${v.description}</small></div>
    <div class='btn-row'>
      <button class='btn' onclick=\"focusLocation('${v.name}')\">Show on Map</button>
      <button class='btn secondary' onclick=\"routeToByName('${v.name}')\">Get Directions</button>
    </div></div>`;
  l.innerHTML=restrooms.map(mk).join('');
}
buildRestroomList();

// === Panels ===
const navItems=document.querySelectorAll('.nav-item'),
overlay=document.getElementById('overlay'),
searchTray=document.getElementById('searchTray');let current=null;
function hidePanels(){document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
navItems.forEach(n=>n.classList.remove('active'));
overlay.classList.remove('active');searchTray.classList.remove('active');current=null;}
function togglePanel(v){
  if(v==='search'){const open=searchTray.classList.contains('active');hidePanels();
    if(!open){rebuildSearchIndex();searchTray.classList.add('active');
    document.querySelector('.nav-item[data-view=\"search\"]').classList.add('active');
    overlay.classList.add('active');setTimeout(()=>document.getElementById('searchInput').focus(),50);
    current='search';}return;}
  if(current===v){hidePanels();return;}
  hidePanels();
  document.getElementById('view-'+v).classList.add('active');
  document.querySelector(`.nav-item[data-view=\"${v}\"]`).classList.add('active');
  overlay.classList.add('active');current=v;
}
overlay.onclick=hidePanels;map.on('click',hidePanels);
navItems.forEach(i=>i.addEventListener('click',()=>togglePanel(i.dataset.view)));

// === Focus ===
function focusLocation(n){const m=markers.find(x=>x.name===n);
  if(m){hidePanels();map.setView(m.getLatLng(),19);m.openPopup();}}

// === Search ===
const searchInput=document.getElementById('searchInput'),searchResults=document.getElementById('searchResults');
document.getElementById('searchClear').onclick=()=>{searchInput.value='';renderResults([]);searchInput.focus();};
let allData=[];
function rebuildSearchIndex(){allData=markers.map(m=>({type:m.category,title:m.name,description:m._desc,target:m.name}));}
function highlight(t,q){if(!q)return t;return t.replace(new RegExp(`(${q})`,'gi'),'<mark>$1</mark>');}
function renderResults(a,q=''){if(!a.length){searchResults.innerHTML='<div class=result>No results found.</div>';return;}
searchResults.innerHTML=a.map(i=>`<div class=result><div class=result-title>${highlight(i.title,q)}</div>
  <div class=result-meta>${i.type} â€” ${highlight(i.description,q)}</div>
  <div class=btn-row><button class=btn onclick=\"focusLocation('${i.title}')\">Show on Map</button>
  <button class='btn secondary' onclick=\"routeToByName('${i.title}')\">Get Directions</button></div></div>`).join('');}
searchInput.addEventListener('input',()=>{const q=searchInput.value.trim().toLowerCase();
if(!q){renderResults([]);return;}
const terms=q.split(/\\s+/);
const r=allData.filter(i=>{const h=(i.title+' '+i.description+' '+i.type).toLowerCase();return terms.every(t=>h.includes(t));});
renderResults(r.slice(0,100),q);});

// === Routing ===
let routeControl=null,userMarker=null,watchId=null,destLatLng=null;
function routeToByName(n){const m=markers.find(x=>x.name===n);
  if(m)startRoutingTo(m.getLatLng());}
function startRoutingTo(l){destLatLng=L.latLng(l);
  if(!navigator.geolocation){alert('Geolocation not supported');return;}
  if(!routeControl){routeControl=L.Routing.control({waypoints:[],addWaypoints:false,draggableWaypoints:false,fitSelectedRoutes:true,show:false,
  router:L.Routing.osrmv1({serviceUrl:'https://router.project-osrm.org/route/v1',profile:'foot'}),
  lineOptions:{styles:[{color:'#2E6CF6',weight:6,opacity:.9}]}}).addTo(map);}
  clearWatch();
  watchId=navigator.geolocation.watchPosition(p=>{
    const h=L.latLng(p.coords.latitude,p.coords.longitude);
    if(!userMarker){userMarker=L.circleMarker(h,{radius:8,color:'#1756ff',fillOpacity:.9}).addTo(map);}else{userMarker.setLatLng(h);}
    routeControl.setWaypoints([h,destLatLng]);
  });
}
function clearWatch(){if(watchId!==null){navigator.geolocation.clearWatch(watchId);watchId=null;}}
</script>
</body>
</html>
